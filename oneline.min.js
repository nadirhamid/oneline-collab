// Frontend of Oneline
// @author Nadir Hamid
// @license MIT

function clone(t,e){if(null==t||"object"!=typeof t)return t;if(void 0==e)e=[];else{var r,n=e.length;for(r=0;n>r;r++)if(t===e[r])return t}if(e.push(t),"function"==typeof t.clone)return t.clone(!0);if("[object Array]"==Object.prototype.toString.call(t)){i=t.slice();for(var r=i.length;r--;)i[r]=clone(i[r],e);return i}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);var o=Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__;o||(o=t.constructor.prototype);var i=object_create(o);for(var s in t)i[s]=clone(t[s],e);return i}var bson=function(){function t(){return a()}function e(){return r(Array.prototype.join.call(arguments,"/"))}function r(t){for(var e,r,n=[],o=t.split("/"),i=0,s=o.length-1;s>=i;i++)e=o[i],("."!==e||void 0===r)&&(".."===e&&n.length&&".."!==r&&"."!==r&&void 0!==r?(n.pop(),r=n.slice(-1)[0]):("."===r&&n.pop(),n.push(e),r=e));return n.join("/")}function n(t){return t&&t.substr(0,t.lastIndexOf("/"))||"."}function o(t,r){for(var o,i,s=e(n(t.id),/\.\/$/.test(r)?r+"index":r).replace(/\.js$/,""),f=e(s,"index"),u=t.pkg,a=u.modules.length;a-->0;)if(i=u.modules[a].id,i==s||i==f){o=u.modules[a];break}return o}function i(t){function e(r){var n,i;if(/^\./.test(r))n=o(t,r);else{if(u&&u.hasOwnProperty(r))return u[r];if(aliases&&aliases.hasOwnProperty(r))return e(aliases[r]);if(i=h[r],!i&&l){try{i=l(r)}catch(s){}if(i)return i}if(!i)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");n=i.index}if(!n)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");return n.parent=t,n.call()}return e}function s(t,e,r){var n={pkg:t,id:e,wrapper:r},o=!1;n.exports={},n.require=i(n),n.call=function(){return o?n.exports:(o=!0,c.require=n.require,n.wrapper(n,n.exports,c,c.require),n.exports)},t.mainModuleId==n.id&&(t.index=n,0===t.parents.length&&(a=n.call)),t.modules.push(n)}function f(){var t=arguments[arguments.length-1],e=Array.prototype.slice.call(arguments,0,arguments.length-1),r=t(e);return h[r.name]=r,1==arguments.length&&(h.main=r),function(t){var e;for(e in t)s(r,e,t[e])}}var u,a,h={},c={},l="undefined"!=typeof require&&require;return t.main=t,t.module=s,t.packages=h,t.pkg=f,t.require=function(t){return h.main.index.require(t)},u={},aliases={},t}(this);bson.pkg(function(t){return{name:"bson",mainModuleId:"bson",modules:[],parents:t}})({binary:function(t,e,r,n){function o(t,e){if(!(this instanceof o))return new o(t,e);if(this._bsontype="Binary",t instanceof Number?(this.sub_type=t,this.position=0):(this.sub_type=null==e?s:e,this.position=0),null==t||t instanceof Number)this.buffer="undefined"!=typeof i?new i(o.BUFFER_SIZE):"undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE)):new Array(o.BUFFER_SIZE),this.position=0;else{if("string"==typeof t)if("undefined"!=typeof i)this.buffer=new i(t);else{if("undefined"==typeof Uint8Array&&"[object Array]"!=Object.prototype.toString.call(t))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=f(t)}else this.buffer=t;this.position=t.length}}if("undefined"==typeof window)var i=n("buffer").Buffer;var s=0,f=function(t){for(var e="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t.length)):new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e},u=function(t,e,r){for(var n="",o=e;r>o;o++)n+=String.fromCharCode(t[o]);return n};o.prototype.put=function(t){if(null!=t.length&&"number"!=typeof t&&1!=t.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&0>t||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var e=null;if(e="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=e;else if("undefined"!=typeof i&&i.isBuffer(this.buffer)){var r=new i(o.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=e}else{var r=null;r="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(o.BUFFER_SIZE+this.buffer.length)):new Array(o.BUFFER_SIZE+this.buffer.length);for(var n=0;n<this.buffer.length;n++)r[n]=this.buffer[n];this.buffer=r,this.buffer[this.position++]=e}},o.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var r=null;if("undefined"!=typeof i&&i.isBuffer(this.buffer))r=new i(this.buffer.length+t.length),this.buffer.copy(r,0,0,this.buffer.length);else if("[object Uint8Array]"==Object.prototype.toString.call(this.buffer)){r=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var n=0;n<this.position;n++)r[n]=this.buffer[n]}this.buffer=r}if("undefined"!=typeof i&&i.isBuffer(t)&&i.isBuffer(this.buffer))t.copy(this.buffer,e,0,t.length),this.position=e+t.length>this.position?e+t.length:this.position;else if("undefined"!=typeof i&&"string"==typeof t&&i.isBuffer(this.buffer))this.buffer.write(t,"binary",e),this.position=e+t.length>this.position?e+t.length:this.position;else if("[object Uint8Array]"==Object.prototype.toString.call(t)||"[object Array]"==Object.prototype.toString.call(t)&&"string"!=typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t[n];this.position=e>this.position?e:this.position}else if("string"==typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t.charCodeAt(n);this.position=e>this.position?e:this.position}},o.prototype.read=function(t,e){if(e=e&&e>0?e:this.position,this.buffer.slice)return this.buffer.slice(t,t+e);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e)):new Array(e),n=0;e>n;n++)r[n]=this.buffer[t++];return r},o.prototype.value=function(t){if(t=null==t?!1:t,"undefined"!=typeof i&&i.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var e="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),r=0;r<this.position;r++)e[r]=this.buffer[r];return e}return u(this.buffer,0,this.position)},o.prototype.length=function(){return this.position},o.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},o.prototype.toString=function(t){return null!=this.buffer?this.buffer.slice(0,this.position).toString(t):""},o.BUFFER_SIZE=256,o.SUBTYPE_DEFAULT=0,o.SUBTYPE_FUNCTION=1,o.SUBTYPE_BYTE_ARRAY=2,o.SUBTYPE_UUID_OLD=3,o.SUBTYPE_UUID=4,o.SUBTYPE_MD5=5,o.SUBTYPE_USER_DEFINED=128,e.Binary=o},binary_parser:function(t,e,n,o){function i(t,e){return this instanceof i?(this.bigEndian=t,void(this.allowExceptions=e)):new i(t,e)}function s(t,e){this.bigEndian=t||0,this.buffer=[],this.setBuffer(e)}for(var f=String.fromCharCode,u=[],a=0;64>a;a++)u[a]=Math.pow(2,a);i.warn=function(t){if(this.allowExceptions)throw new Error(t);return 1},i.decodeFloat=function(t,e,r){var n=new this.Buffer(this.bigEndian,t);n.checkBuffer(e+r+1);var o=u[r-1]-1,i=n.readBits(e+r,1),s=n.readBits(e,r),f=0,a=2,h=n.buffer.length+(-e>>3)-1;do for(var c=n.buffer[++h],l=e%8||8,p=1<<l;p>>=1;c&p&&(f+=1/a),a*=2);while(e-=l);return s==(o<<1)+1?f?0/0:i?-1/0:+1/0:(1+-2*i)*(s||f?s?Math.pow(2,s-o)*(1+f):Math.pow(2,-o+1)*f:0)},i.decodeInt=function(t,e,r,n){var o=new this.Buffer(this.bigEndian||n,t),i=o.readBits(0,e),s=u[e];return r&&i>=s/2?i-s:i},i.encodeFloat=function(t,e,n){var o,i,s,f,a,h=u[n-1]-1,c=-h+1,l=h,p=c-e,_=parseFloat(t),d=isNaN(_)||_==-1/0||_==+1/0?_:0,g=0,y=2*h+1+e+3,B=new Array(y),O=(_=0!==d?0:_)<0,b=Math.floor(_=Math.abs(_)),m=_-b;for(f=y;f;B[--f]=0);for(f=h+2;b&&f;B[--f]=b%2,b=Math.floor(b/2));for(f=h+1;m>0&&f;(B[++f]=((m*=2)>=1)-0)&&--m);for(f=-1;++f<y&&!B[f];);if(B[(o=e-1+(f=(g=h+1-f)>=c&&l>=g?f+1:h+1-(g=c-1)))+1]){if(!(i=B[o]))for(a=o+2;!i&&y>a;i=B[a++]);for(a=o+1;i&&--a>=0;(B[a]=!B[a]-0)&&(i=0));}for(f=0>f-2?-1:f-3;++f<y&&!B[f];);for((g=h+1-f)>=c&&l>=g?++f:c>g&&(g!=h+1-y&&p>g&&this.warn("encodeFloat::float underflow"),f=h+1-(g=c-1)),(b||0!==d)&&(this.warn(b?"encodeFloat::float overflow":"encodeFloat::"+d),g=l+1,f=h+2,d==-1/0?O=1:isNaN(d)&&(B[f]=1)),_=Math.abs(g+h),a=n+1,s="";--a;s=_%2+s,_=_>>=1);for(_=0,a=0,f=(s=(O?"1":"0")+s+B.slice(f,f+e).join("")).length,r=[];f;a=(a+1)%8)_+=(1<<a)*s.charAt(--f),7==a&&(r[r.length]=String.fromCharCode(_),_=0);return r[r.length]=_?String.fromCharCode(_):"",(this.bigEndian?r.reverse():r).join("")},i.encodeInt=function(t,e,r,n){var o=u[e];(t>=o||-(o/2)>t)&&(this.warn("encodeInt::overflow"),t=0),0>t&&(t+=o);for(var i=[];t;i[i.length]=String.fromCharCode(t%256),t=Math.floor(t/256));for(e=-(-e>>3)-i.length;e--;i[i.length]="\x00");return(this.bigEndian||n?i.reverse():i).join("")},i.toSmall=function(t){return this.decodeInt(t,8,!0)},i.fromSmall=function(t){return this.encodeInt(t,8,!0)},i.toByte=function(t){return this.decodeInt(t,8,!1)},i.fromByte=function(t){return this.encodeInt(t,8,!1)},i.toShort=function(t){return this.decodeInt(t,16,!0)},i.fromShort=function(t){return this.encodeInt(t,16,!0)},i.toWord=function(t){return this.decodeInt(t,16,!1)},i.fromWord=function(t){return this.encodeInt(t,16,!1)},i.toInt=function(t){return this.decodeInt(t,32,!0)},i.fromInt=function(t){return this.encodeInt(t,32,!0)},i.toLong=function(t){return this.decodeInt(t,64,!0)},i.fromLong=function(t){return this.encodeInt(t,64,!0)},i.toDWord=function(t){return this.decodeInt(t,32,!1)},i.fromDWord=function(t){return this.encodeInt(t,32,!1)},i.toQWord=function(t){return this.decodeInt(t,64,!0)},i.fromQWord=function(t){return this.encodeInt(t,64,!0)},i.toFloat=function(t){return this.decodeFloat(t,23,8)},i.fromFloat=function(t){return this.encodeFloat(t,23,8)},i.toDouble=function(t){return this.decodeFloat(t,52,11)},i.fromDouble=function(t){return this.encodeFloat(t,52,11)},i.encode_int32=function(t,e){var r,n,o,i,s;return s=0>t?t+4294967296:t,r=Math.floor(s/16777215),s&=16777215,n=Math.floor(s/65535),s&=65535,o=Math.floor(s/255),s&=255,i=Math.floor(s),e?[f(r),f(n),f(o),f(i)]:f(r)+f(n)+f(o)+f(i)},i.encode_int64=function(t){var e,r,n,o,i,s,u,a,h;return h=0>t?t+0x10000000000000000:t,e=Math.floor(h/72057594037927940),h&=72057594037927940,r=Math.floor(h/0xffffffffffff),h&=0xffffffffffff,n=Math.floor(h/0xffffffffff),h&=0xffffffffff,o=Math.floor(h/4294967295),h&=4294967295,i=Math.floor(h/16777215),h&=16777215,s=Math.floor(h/65535),h&=65535,u=Math.floor(h/255),h&=255,a=Math.floor(h),f(e)+f(r)+f(n)+f(o)+f(i)+f(s)+f(u)+f(a)},i.decode_utf8=function(t){for(var e,r=t.length,n="",o=0,i=0,s=0;r>o;)i=t.charCodeAt(o),128>i?(n+=String.fromCharCode(i),o++):i>191&&224>i?(s=t.charCodeAt(o+1),n+=String.fromCharCode((31&i)<<6|63&s),o+=2):(s=t.charCodeAt(o+1),e=t.charCodeAt(o+2),n+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&e),o+=3);return n},i.encode_cstring=function(t){return unescape(encodeURIComponent(t))+i.fromByte(0)},i.encode_utf8=function(t){for(var e,r="",n=0,o=t.length;o>n;n++)e=t.charCodeAt(n),128>e?r+=String.fromCharCode(e):e>127&&2048>e?(r+=String.fromCharCode(e>>6|192),r+=String.fromCharCode(63&e|128)):(r+=String.fromCharCode(e>>12|224),r+=String.fromCharCode(e>>6&63|128),r+=String.fromCharCode(63&e|128));return r},i.hprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" "));process.stdout.write("\n\n")},i.ilprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),o("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),o("util").debug(e+" : "+t.charAt(r)))},i.hlprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),o("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),o("util").debug(e+" : "+t.charAt(r)))},s.prototype.setBuffer=function(t){var e,r,n;if(t){for(r=e=t.length,n=this.buffer=new Array(e);r;n[e-r]=t.charCodeAt(--r));this.bigEndian&&n.reverse()}},s.prototype.hasNeededBits=function(t){return this.buffer.length>=-(-t>>3)},s.prototype.checkBuffer=function(t){if(!this.hasNeededBits(t))throw new Error("checkBuffer::missing bytes")},s.prototype.readBits=function(t,e){function r(t,e){for(;e--;t=1073741824==(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483647+1);return t}if(0>t||0>=e)return 0;this.checkBuffer(t+e);for(var n,o=t%8,i=this.buffer.length-(t>>3)-1,s=this.buffer.length+(-(t+e)>>3),f=i-s,u=(this.buffer[i]>>o&(1<<(f?8-o:e))-1)+(f&&(n=(t+e)%8)?(this.buffer[s++]&(1<<n)-1)<<(f--<<3)-o:0);f;u+=r(this.buffer[s++],(f--<<3)-o));return u},i.Buffer=s,e.BinaryParser=i},bson:function(module,exports,global,require,undefined){function BSON(){}function calculateElement(t,e,r){var n="undefined"!=typeof Buffer;switch(typeof e){case"string":return 1+(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1+4+(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1;case"number":return Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX&&e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+5:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;case"undefined":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;case"boolean":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+2;case"object":if(null==e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;if(e instanceof ObjectID||"ObjectID"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+13;if(e instanceof Date||isDate(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+6+e.length;if(e instanceof Long||e instanceof Double||e instanceof Timestamp||"Long"==e._bsontype||"Double"==e._bsontype||"Timestamp"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if(e instanceof Code||"Code"==e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1+BSON.calculateObjectSize(e.scope,r):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1;if(e instanceof Binary||"Binary"==e._bsontype)return e.sub_type==Binary.SUBTYPE_BYTE_ARRAY?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1+4):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1);if(e instanceof Symbol||"Symbol"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+((n?Buffer.byteLength(e.value,"utf8"):numberOfBytes(e.value))+4+1+1);if(e instanceof DBRef||"DBRef"==e._bsontype){var o={$ref:e.namespace,$id:e.oid};return null!=e.db&&(o.$db=e.db),(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+BSON.calculateObjectSize(o,r)}return e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+BSON.calculateObjectSize(e,r)+1;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(r&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1+BSON.calculateObjectSize(e.scope,r);if(r)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1}return 0}var Long=require("./long").Long,Double=require("./double").Double,Timestamp=require("./timestamp").Timestamp,ObjectID=require("./objectid").ObjectID,Symbol=require("./symbol").Symbol,Code=require("./code").Code,MinKey=require("./min_key").MinKey,MaxKey=require("./max_key").MaxKey,DBRef=require("./db_ref").DBRef,Binary=require("./binary").Binary,BinaryParser=require("./binary_parser").BinaryParser,writeIEEE754=require("./float_parser").writeIEEE754,readIEEE754=require("./float_parser").readIEEE754,isDate=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)};BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.calculateObjectSize=function(t,e){var r=5;if(Array.isArray(t))for(var n=0;n<t.length;n++)r+=calculateElement(n.toString(),t[n],e);else{t.toBSON&&(t=t.toBSON());for(var o in t)r+=calculateElement(o,t[o],e)}return r},BSON.serializeWithBufferAndIndex=function(t,e,r,n,o){o=null==o?!1:o;var i=r.length;return r[n++]=255&i,r[n++]=i>>8&255,r[n++]=i>>16&255,r[n++]=i>>24&255,serializeObject(t,e,r,n,o)-1};var serializeObject=function(t,e,r,n,o){if(Array.isArray(t))for(var i=0;i<t.length;i++)n=packElement(i.toString(),t[i],e,r,n,o);else{t.toBSON&&(t=t.toBSON());for(var s in t)"$db"!=s&&"$ref"!=s&&"$id"!=s&&BSON.checkKey(s,!e),n=packElement(s,t[s],e,r,n,o)}return r[n++]=0,n},stringToBytes=function(t){for(var e,r,n=[],o=0;o<t.length;o++){e=t.charCodeAt(o),r=[];do r.push(255&e),e>>=8;while(e);n=n.concat(r.reverse())}return n},numberOfBytes=function(t){for(var e,r,n=0,o=0;o<t.length;o++){e=t.charCodeAt(o),r=[];do r.push(255&e),e>>=8;while(e);n+=r.length}return n},writeToTypedArray=function(t,e,r){for(var n=stringToBytes(e),o=0;o<n.length;o++)t[r+o]=n[o];return n.length},supportsBuffer="undefined"!=typeof Buffer,packElement=function(t,e,r,n,o,i){switch(typeof e){case"string":n[o++]=BSON.BSON_DATA_STRING;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var f=supportsBuffer?Buffer.byteLength(e)+1:numberOfBytes(e)+1;return n[o+3]=f>>24&255,n[o+2]=f>>16&255,n[o+1]=f>>8&255,n[o]=255&f,o+=4,supportsBuffer?n.write(e,o,"utf8"):writeToTypedArray(n,e,o),o=o+f-1,n[o++]=0,o;case"number":if(Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX)if(e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX){n[o++]=BSON.BSON_DATA_INT;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0,n[o++]=255&e,n[o++]=e>>8&255,n[o++]=e>>16&255,n[o++]=e>>24&255}else if(e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX){n[o++]=BSON.BSON_DATA_NUMBER;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0,writeIEEE754(n,e,o,"little",52,8),o+=8}else{n[o++]=BSON.BSON_DATA_LONG;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var u=Long.fromNumber(e),a=u.getLowBits(),h=u.getHighBits();n[o++]=255&a,n[o++]=a>>8&255,n[o++]=a>>16&255,n[o++]=a>>24&255,n[o++]=255&h,n[o++]=h>>8&255,n[o++]=h>>16&255,n[o++]=h>>24&255}else{n[o++]=BSON.BSON_DATA_NUMBER;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0,writeIEEE754(n,e,o,"little",52,8),o+=8}return o;case"undefined":n[o++]=BSON.BSON_DATA_NULL;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,o;case"boolean":n[o++]=BSON.BSON_DATA_BOOLEAN;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,n[o++]=e?1:0,o;case"object":if(null===e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype){n[o++]=null===e?BSON.BSON_DATA_NULL:e instanceof MinKey?BSON.BSON_DATA_MIN_KEY:BSON.BSON_DATA_MAX_KEY;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,o}if(e instanceof ObjectID||"ObjectID"==e._bsontype){n[o++]=BSON.BSON_DATA_OID;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,supportsBuffer?n.write(e.id,o,"binary"):writeToTypedArray(n,e.id,o),o+=12}if(e instanceof Date||isDate(e)){n[o++]=BSON.BSON_DATA_DATE;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var c=Long.fromNumber(e.getTime()),a=c.getLowBits(),h=c.getHighBits();return n[o++]=255&a,n[o++]=a>>8&255,n[o++]=a>>16&255,n[o++]=a>>24&255,n[o++]=255&h,n[o++]=h>>8&255,n[o++]=h>>16&255,n[o++]=h>>24&255,o}if("undefined"!=typeof Buffer&&Buffer.isBuffer(e)){n[o++]=BSON.BSON_DATA_BINARY;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var f=e.length;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,n[o++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT,e.copy(n,o,0,f),o+=f}if(e instanceof Long||e instanceof Timestamp||"Long"==e._bsontype||"Timestamp"==e._bsontype){n[o++]=e instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var a=e.getLowBits(),h=e.getHighBits();return n[o++]=255&a,n[o++]=a>>8&255,n[o++]=a>>16&255,n[o++]=a>>24&255,n[o++]=255&h,n[o++]=h>>8&255,n[o++]=h>>16&255,n[o++]=h>>24&255,o}if(e instanceof Double||"Double"==e._bsontype){n[o++]=BSON.BSON_DATA_NUMBER;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,writeIEEE754(n,e,o,"little",52,8),o+=8}if(e instanceof Code||"Code"==e._bsontype){if(null!=e.scope&&Object.keys(e.scope).length>0){n[o++]=BSON.BSON_DATA_CODE_W_SCOPE;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var l=BSON.calculateObjectSize(e.scope,i),p=e.code.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,d=4+_+l+4;n[o++]=255&d,n[o++]=d>>8&255,n[o++]=d>>16&255,n[o++]=d>>24&255,n[o++]=255&_,n[o++]=_>>8&255,n[o++]=_>>16&255,n[o++]=_>>24&255,supportsBuffer?n.write(p,o,"utf8"):writeToTypedArray(n,p,o),o=o+_-1,n[o++]=0;var g=supportsBuffer?new Buffer(l):new Uint8Array(new ArrayBuffer(l));serializeObject(e.scope,r,g,0,i);var y=l;return n[o++]=255&y,n[o++]=y>>8&255,n[o++]=y>>16&255,n[o++]=y>>24&255,supportsBuffer?g.copy(n,o,0,l):n.set(g,o),o=o+y-5,n[o++]=0,o}n[o++]=BSON.BSON_DATA_CODE;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var p=e.code.toString(),f=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,supportsBuffer?n.write(p,o,"utf8"):writeToTypedArray(n,p,o),o=o+f-1,n[o++]=0,o}if(e instanceof Binary||"Binary"==e._bsontype){n[o++]=BSON.BSON_DATA_BINARY;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var B=e.value(!0),f=e.position;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,n[o++]=e.sub_type,e.sub_type==Binary.SUBTYPE_BYTE_ARRAY&&(n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255),supportsBuffer?B.copy(n,o,0,e.position):n.set(B,o),o+=e.position}if(e instanceof Symbol||"Symbol"==e._bsontype){n[o++]=BSON.BSON_DATA_SYMBOL;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var f=supportsBuffer?Buffer.byteLength(e.value)+1:numberOfBytes(e.value)+1;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,n.write(e.value,o,"utf8"),o=o+f-1,n[o++]=0,o}if(e instanceof DBRef||"DBRef"==e._bsontype){n[o++]=BSON.BSON_DATA_OBJECT;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var O={$ref:e.namespace,$id:e.oid};null!=e.db&&(O.$db=e.db);var f=BSON.calculateObjectSize(O,i),b=BSON.serializeWithBufferAndIndex(O,r,n,o,i);return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,n[b++]=0,b}if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)){n[o++]=BSON.BSON_DATA_REGEXP;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,supportsBuffer?n.write(e.source,o,"utf8"):writeToTypedArray(n,e.source,o),o+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[o++]=0,e.global&&(n[o++]=115),e.ignoreCase&&(n[o++]=105),e.multiline&&(n[o++]=109),n[o++]=0,o}n[o++]=Array.isArray(e)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var b=serializeObject(e,r,n,o+4,i),f=b-o;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,b;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e)){n[o++]=BSON.BSON_DATA_REGEXP;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);return o=o+s+1,n[o-1]=0,n.write(e.source,o,"utf8"),o+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[o++]=0,e.global&&(n[o++]=115),e.ignoreCase&&(n[o++]=105),e.multiline&&(n[o++]=109),n[o++]=0,o}if(i&&null!=e.scope&&Object.keys(e.scope).length>0){n[o++]=BSON.BSON_DATA_CODE_W_SCOPE;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var l=BSON.calculateObjectSize(e.scope,i),p=e.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,d=4+_+l;n[o++]=255&d,n[o++]=d>>8&255,n[o++]=d>>16&255,n[o++]=d>>24&255,n[o++]=255&_,n[o++]=_>>8&255,n[o++]=_>>16&255,n[o++]=_>>24&255,supportsBuffer?n.write(p,o,"utf8"):writeToTypedArray(n,p,o),o=o+_-1,n[o++]=0;var g=new Buffer(l);serializeObject(e.scope,r,g,0,i);var y=l-4;return n[o++]=255&y,n[o++]=y>>8&255,n[o++]=y>>16&255,n[o++]=y>>24&255,g.copy(n,o,0,l),o=o+y-5,n[o++]=0,o}if(i){n[o++]=BSON.BSON_DATA_CODE;var s=supportsBuffer?n.write(t,o,"utf8"):writeToTypedArray(n,t,o);o=o+s+1,n[o-1]=0;var p=e.toString(),f=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[o++]=255&f,n[o++]=f>>8&255,n[o++]=f>>16&255,n[o++]=f>>24&255,supportsBuffer?n.write(p,o,"utf8"):writeToTypedArray(n,p,o),o=o+f-1,n[o++]=0,o}}return o};BSON.serialize=function(t,e,r,n){if(null==t||"object"!=typeof t||Array.isArray(t))throw new Error("Only javascript objects supported");var o=null,i=BSON.calculateObjectSize(t,n);return(o="undefined"!=typeof Buffer)?(o=new Buffer(i),r=!0):o="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(i)):new Array(i),BSON.serializeWithBufferAndIndex(t,e,o,0,n),o};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(t,e,r){var n=0,o=0,i=0;n=-1^n;for(var s=e,f=r;f>s;s++)i=255&(n^t[s]),o=table[i],n=n>>>8^o;return-1^n};BSON.deserializeStream=function(t,e,r,n,o,i){i=null!=i?i:{};for(var s=e,f=0;r>f;f++){var u=t[s]|t[s+1]<<8|t[s+2]<<16|t[s+3]<<24;i.index=s,n[o+f]=BSON.deserialize(t,i),s+=u}return s};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},convertUint8ArrayToUtf8String=function(t,e,r){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(t,e,r))},convertArraytoUtf8BinaryString=function(t,e,r){for(var n="",o=e;r>o;o++)n+=String.fromCharCode(t[o]);return n};BSON.deserialize=function(t,e,r){e=null==e?{}:e;var n=null==e.evalFunctions?!1:e.evalFunctions,o=null==e.cacheFunctions?!1:e.cacheFunctions,i=null==e.cacheFunctionsCrc32?!1:e.cacheFunctionsCrc32,s=e.promoteLongs||!0;if(t.length<5)throw new Error("corrupt bson message < 5 bytes long");var f="number"==typeof e.index?e.index:0,u=function(){for(var e=f;0!==t[e];)e++;var r=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",f,e):convertUint8ArrayToUtf8String(t,f,e);return f=e+1,r},a=r?[]:{},h=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;if(5>h||h>t.length)throw new Error("corrupt bson message");for(;;){var c=t[f++];if(0==c)break;var l=u();switch(c){case BSON.BSON_DATA_OID:var p=supportsBuffer&&Buffer.isBuffer(t)?t.toString("binary",f,f+12):convertArraytoUtf8BinaryString(t,f,f+12);
a[l]=new ObjectID(p),f+=12;break;case BSON.BSON_DATA_STRING:var _=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;a[l]=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",f,f+_-1):convertUint8ArrayToUtf8String(t,f,f+_-1),f+=_;break;case BSON.BSON_DATA_INT:a[l]=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;break;case BSON.BSON_DATA_NUMBER:a[l]=readIEEE754(t,f,"little",52,8),f+=8;break;case BSON.BSON_DATA_DATE:var d=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,g=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;a[l]=new Date(new Long(d,g).toNumber());break;case BSON.BSON_DATA_BOOLEAN:a[l]=1==t[f++];break;case BSON.BSON_DATA_NULL:a[l]=null;break;case BSON.BSON_DATA_BINARY:var y=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,B=t[f++];if(null!=t.slice)B==Binary.SUBTYPE_BYTE_ARRAY&&(y=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24),a[l]=new Binary(t.slice(f,f+y),B);else{var O="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(y)):new Array(y);B==Binary.SUBTYPE_BYTE_ARRAY&&(y=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24);for(var b=0;y>b;b++)O[b]=t[f+b];a[l]=new Binary(O,B)}f+=y;break;case BSON.BSON_DATA_ARRAY:e.index=f;var m=t[f]|t[f+1]<<8|t[f+2]<<16|t[f+3]<<24;a[l]=BSON.deserialize(t,e,!0),f+=m;break;case BSON.BSON_DATA_OBJECT:e.index=f;var m=t[f]|t[f+1]<<8|t[f+2]<<16|t[f+3]<<24;a[l]=BSON.deserialize(t,e,!1),f+=m;break;case BSON.BSON_DATA_REGEXP:for(var N=u(),S=u(),w=new Array(S.length),b=0;b<S.length;b++)switch(S[b]){case"m":w[b]="m";break;case"s":w[b]="g";break;case"i":w[b]="i"}a[l]=new RegExp(N,w.join(""));break;case BSON.BSON_DATA_LONG:var d=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,g=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,A=new Long(d,g);a[l]=s&&A.lessThanOrEqual(JS_INT_MAX_LONG)&&A.greaterThanOrEqual(JS_INT_MIN_LONG)?A.toNumber():A;break;case BSON.BSON_DATA_SYMBOL:var _=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;a[l]=new Symbol(t.toString("utf8",f,f+_-1)),f+=_;break;case BSON.BSON_DATA_TIMESTAMP:var d=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,g=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24;a[l]=new Timestamp(d,g);break;case BSON.BSON_DATA_MIN_KEY:a[l]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:a[l]=new MaxKey;break;case BSON.BSON_DATA_CODE:var _=t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,v=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",f,f+_-1):convertUint8ArrayToUtf8String(t,f,f+_-1);if(n){if(o){var T=i?crc32(v):v;a[l]=isolateEvalWithHash(functionCache,T,v,a)}else a[l]=isolateEval(v)}else a[l]=new Code(v,{});f+=_;break;case BSON.BSON_DATA_CODE_W_SCOPE:var _=(t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24,t[f++]|t[f++]<<8|t[f++]<<16|t[f++]<<24),v=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",f,f+_-1):convertUint8ArrayToUtf8String(t,f,f+_-1);f+=_,e.index=f;var m=t[f]|t[f+1]<<8|t[f+2]<<16|t[f+3]<<24,E=BSON.deserialize(t,e,!1);if(f+=m,n){if(o){var T=i?crc32(v):v;a[l]=isolateEvalWithHash(functionCache,T,v,a)}else a[l]=isolateEval(v);a[l].scope=E}else a[l]=new Code(v,E)}}return null!=a.$id&&(a=new DBRef(a.$ref,a.$id,a.$db)),a},BSON.checkKey=function(t,e){if(t.length){if(~t.indexOf("\x00"))throw Error("key "+t+" must not contain null bytes");if(!e){if("$"==t[0])throw Error("key "+t+" must not start with '$'");if(~t.indexOf("."))throw Error("key "+t+" must not contain '.'")}}},BSON.prototype.deserialize=function(t,e){return BSON.deserialize(t,e)},BSON.prototype.deserializeStream=function(t,e,r,n,o,i){return BSON.deserializeStream(t,e,r,n,o,i)},BSON.prototype.serialize=function(t,e,r,n){return BSON.serialize(t,e,r,n)},BSON.prototype.calculateObjectSize=function(t,e){return BSON.calculateObjectSize(t,e)},BSON.prototype.serializeWithBufferAndIndex=function(t,e,r,n,o){return BSON.serializeWithBufferAndIndex(t,e,r,n,o)},exports.Code=Code,exports.Symbol=Symbol,exports.BSON=BSON,exports.DBRef=DBRef,exports.Binary=Binary,exports.ObjectID=ObjectID,exports.Long=Long,exports.Timestamp=Timestamp,exports.Double=Double,exports.MinKey=MinKey,exports.MaxKey=MaxKey},code:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Code",this.code=t,void(this.scope=null==e?{}:e)):new r(t,e)}r.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.Code=r},db_ref:function(t,e){function r(t,e,n){return this instanceof r?(this._bsontype="DBRef",this.namespace=t,this.oid=e,void(this.db=n)):new r(t,e,n)}r.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.DBRef=r},"double":function(t,e){function r(t){return this instanceof r?(this._bsontype="Double",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Double=r},float_parser:function(t,e){var r=function(t,e,r,n,o){var i,s,f="big"===r,u=8*o-n-1,a=(1<<u)-1,h=a>>1,c=-7,l=f?0:o-1,p=f?1:-1,_=t[e+l];for(l+=p,i=_&(1<<-c)-1,_>>=-c,c+=u;c>0;i=256*i+t[e+l],l+=p,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;c>0;s=256*s+t[e+l],l+=p,c-=8);if(0===i)i=1-h;else{if(i===a)return s?0/0:1/0*(_?-1:1);s+=Math.pow(2,n),i-=h}return(_?-1:1)*s*Math.pow(2,i-n)},n=function(t,e,r,n,o,i){var s,f,u,a="big"===n,h=8*i-o-1,c=(1<<h)-1,l=c>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,_=a?i-1:0,d=a?-1:1,g=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(f=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+l>=1?p/u:p*Math.pow(2,1-l),e*u>=2&&(s++,u/=2),s+l>=c?(f=0,s=c):s+l>=1?(f=(e*u-1)*Math.pow(2,o),s+=l):(f=e*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;t[r+_]=255&f,_+=d,f/=256,o-=8);for(s=s<<o|f,h+=o;h>0;t[r+_]=255&s,_+=d,s/=256,h-=8);t[r+_-d]|=128*g};e.readIEEE754=r,e.writeIEEE754=n},index:function(t,e,r,n){try{e.BSONPure=n("./bson"),e.BSONNative=n("../../ext")}catch(o){}["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long"].forEach(function(t){var r=n("./"+t);for(var o in r)e[o]=r[o]}),e["native"]=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","../../ext"].forEach(function(e){var r=n("./"+e);for(var o in r)t[o]=r[o]}),t},e.pure=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","././bson"].forEach(function(e){var r=n("./"+e);for(var o in r)t[o]=r[o]}),t}},"long":function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Long",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),o=this.div(n),i=o.multiply(n).subtract(this);return o.toString(e)+i.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var s=r.fromNumber(Math.pow(e,6)),i=this,f="";;){var u=i.div(s),a=i.subtract(u.multiply(s)).toInt(),h=a.toString(e);if(i=u,i.isZero())return h+f;for(;h.length<6;)h="0"+h;f=""+h+f}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,f=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=i+a,l+=p>>>16,p&=65535,l+=o+u,c+=l>>>16,l&=65535,c+=n+f,h+=c>>>16,c&=65535,h+=e+s,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,f=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=i*a,l+=p>>>16,p&=65535,l+=o*a,c+=l>>>16,l&=65535,l+=i*u,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=o*u,h+=c>>>16,c&=65535,c+=i*f,h+=c>>>16,c&=65535,h+=e*a+n*u+o*f+i*s,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var o=this.subtract(t.multiply(n)),i=n.add(o.div(t));return i}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var s=r.ZERO,o=this;o.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(o.toNumber()/t.toNumber())),f=Math.ceil(Math.log(n)/Math.LN2),u=48>=f?1:Math.pow(2,f-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(o);)n-=u,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),s=s.add(a),o=o.subtract(h)}return s},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var o=r.fromNumber(Math.pow(n,8)),i=r.ZERO,s=0;s<t.length;s+=8){var f=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+f),n);if(8>f){var a=r.fromNumber(Math.pow(n,f));i=i.multiply(a).add(r.fromNumber(u))}else i=i.multiply(o),i=i.add(r.fromNumber(u))}return i},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Long=r},max_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MaxKey"):new r}e.MaxKey=r},min_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MinKey"):new r}e.MinKey=r},objectid:function(t,e,r,n){for(var o=n("./binary_parser").BinaryParser,i=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$"),f=function h(t,e){if(!(this instanceof h))return new h(t,e);this._bsontype="ObjectID";if(null!=t&&"number"!=typeof t&&12!=t.length&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(null==t||"number"==typeof t)this.id=this.generate(t);else{if(null==t||12!==t.length){if(s.test(t))return h.createFromHexString(t);throw new Error("Value passed in is not a valid 24 character hex string")}this.id=t}h.cacheHexString&&(this.__id=this.toHexString())},u=[],a=0;256>a;a++)u[a]=(15>=a?"0":"")+a.toString(16);f.prototype.toHexString=function(){if(f.cacheHexString&&this.__id)return this.__id;for(var t="",e=0;e<this.id.length;e++)t+=u[this.id.charCodeAt(e)];return f.cacheHexString&&(this.__id=t),t},f.prototype.get_inc=function(){return f.index=(f.index+1)%16777215},f.prototype.getInc=function(){return this.get_inc()},f.prototype.generate=function(t){if("number"==typeof t)var e=o.encodeInt(t,32,!0,!0),r=o.encodeInt(i,24,!1),n=o.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),s=o.encodeInt(this.get_inc(),24,!1,!0);else var f=parseInt(Date.now()/1e3,10),e=o.encodeInt(f,32,!0,!0),r=o.encodeInt(i,24,!1),n=o.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),s=o.encodeInt(this.get_inc(),24,!1,!0);return e+r+n+s},f.prototype.toString=function(){return this.toHexString()},f.prototype.inspect=f.prototype.toString,f.prototype.toJSON=function(){return this.toHexString()},f.prototype.equals=function(t){var e=t instanceof f||t.toHexString?t.id:f.createFromHexString(t).id;return this.id===e},f.prototype.getTimestamp=function(){var t=new Date;return t.setTime(1e3*Math.floor(o.decodeInt(this.id.substring(0,4),32,!0,!0))),t},f.index=parseInt(16777215*Math.random(),10),f.createPk=function(){return new f},f.createFromTime=function(t){var e=o.encodeInt(t,32,!0,!0)+o.encodeInt(0,64,!0,!0);return new f(e)},f.createFromHexString=function(t){if("undefined"==typeof t||null!=t&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var e=t.length;if(e>24)throw new Error("Id cannot be longer than 12 bytes");for(var r,n,i="",s=0;e>s;s+=2)r=t.substr(s,2),n=parseInt(r,16),i+=o.fromByte(n);return new f(i,t)},Object.defineProperty(f.prototype,"generationTime",{enumerable:!0,get:function(){return Math.floor(o.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(t){var t=o.encodeInt(t,32,!0,!0);this.id=t+this.id.substr(4),this.toHexString()}}),e.ObjectID=f,e.ObjectId=f},symbol:function(t,e){function r(t){return this instanceof r?(this._bsontype="Symbol",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toString=function(){return this.value},r.prototype.inspect=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Symbol=r},timestamp:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Timestamp",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),o=this.div(n),i=o.multiply(n).subtract(this);return o.toString(e)+i.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var s=r.fromNumber(Math.pow(e,6)),i=this,f="";;){var u=i.div(s),a=i.subtract(u.multiply(s)).toInt(),h=a.toString(e);if(i=u,i.isZero())return h+f;for(;h.length<6;)h="0"+h;f=""+h+f}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,f=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=i+a,l+=p>>>16,p&=65535,l+=o+u,c+=l>>>16,l&=65535,c+=n+f,h+=c>>>16,c&=65535,h+=e+s,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=t.high_>>>16,f=65535&t.high_,u=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=i*a,l+=p>>>16,p&=65535,l+=o*a,c+=l>>>16,l&=65535,l+=i*u,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=o*u,h+=c>>>16,c&=65535,c+=i*f,h+=c>>>16,c&=65535,h+=e*a+n*u+o*f+i*s,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var o=this.subtract(t.multiply(n)),i=n.add(o.div(t));return i}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var s=r.ZERO,o=this;o.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(o.toNumber()/t.toNumber())),f=Math.ceil(Math.log(n)/Math.LN2),u=48>=f?1:Math.pow(2,f-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(o);)n-=u,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),s=s.add(a),o=o.subtract(h)}return s},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var o=r.fromNumber(Math.pow(n,8)),i=r.ZERO,s=0;s<t.length;s+=8){var f=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+f),n);if(8>f){var a=r.fromNumber(Math.pow(n,f));i=i.multiply(a).add(r.fromNumber(u))}else i=i.multiply(o),i=i.add(r.fromNumber(u))}return i},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Timestamp=r}}),"undefined"!=typeof module&&module.exports&&(module.exports=bson,module.parent||bson()),"undefined"!=typeof window&&"undefined"==typeof require&&(window.require=bson.require),function(){function t(t,e,r){for(property in e)t[property]=e[property];for(property in r)t[property]=r[property];return t}var e,r=this;e="undefined"!=typeof exports?window.Oneline||{}:r.Oneline=window.Oneline||{},min=Math.min,max=Math.max,pow=Math.pow,sqrt=Math.sqrt,log=Math.log,floor=Math.floor,slice=Array.slice,splice=Array.splice,every=Array.every,websocket={},navigator=window.navigator?window.navigator:[],window.BSON=window.BSON||bson().BSON,BSON.stringify=function(t){return O.uint8ToString(BSON.serialize(t))},BSON.parse=function(t){return BSON.deserialize(O.stringToUint*t)},e.interop=BSON,e.socket=e.socket||[],e.settings=e.settings||{},e.freq=e.freq=e.freq||1e3,e.host=e.host||"localhost",e.port=e.port||9e3,e.protoline=e.protoline||[],e.objects=e.objects||[],e.loaded=0,e.setup=function(t){e.settings=t,e.port=t.port||e.port,e.host=t.host||e.host,e.type="bind"===t.type?"bind":"auto",e.on=t.on||"click",e.target=t.target,t.server=t.module||t.server,e.settings.server=t.server.match(/ws\:\/\//)?t.server:t.server="ws://"+e.host+":"+e.port+"/"+t.server,OnelineTransport.WebSockets.detect()?e.socket=OnelineTransport.WebSockets.Ctor(t.server):OnelineTransport.XHR.detect()?(e.settings.xhrurl=t.host+":"+(e.port+1),e.socket=OnelineTransport.XHR.Ctor(e.settings.xhrurl,e.settings.server),e.loaded=!0):console.log("Neither XHR or WebSocket transport is available in this browser"),e.interop="undefined"!=typeof t.interop&&"json"===t.interop?JSON:BSON,e.freq="undefined"!=typeof t.freq?t.freq:e.freq,e.socket.onopen=function(){e.loaded=1},e.socket.onmessage=function(t){},e.order="undefined"!=typeof t.order?t.order:[],e.target=document.getElementById(e.target)},e.contextOptions={geolocation:{limit:{"default":512},range:{"default":40},bidirectional:{"default":!1}}},e.fetchOptional=function(t,r){return"undefined"==typeof r?e.contextOptions[t][r]["default"]:r},e.agent=function(){},e.nodes=function(){},e.stream=function(t){return t=t||{},t.pipeline=t.pipeline||O.protoline,O.pipeline({},t.pipeline,function(t){console.log(t)}).run()},e.value=function(t,e){return{op:t,value:e}},e.moment=function(){return{start:0,end:3600}},e.echo=e.echo=function(t,r){return e.echo.options=t,r||e.objects.push(clone(e.echo(t,1))),{run:function(t){this.m=t||{},this.m.echo={},this.m.echo.limit=O.echo.options.limit,this.state=1}}},e.geolocation=e.geo=function(t,r){return e.geolocation.options=t,r||e.objects.push(clone(e.geo(t,1))),{run:function(t){this.m=t||{},this.m.geo={},this.state=0,this.m.geo.every=O.geolocation.options.every,this.m.geo.range=O.geolocation.options.range,this.m.geo.limit=O.fetchOptional(O.geolocation.options.limit);var e=this;navigator.geolocation.getCurrentPosition(function(t){e.m.geo.lat=t.coords.longitude,e.m.geo.lng=t.coords.latitude,e.m.geo.range=O.geolocation.options.range,e.m.geo.limit=O.geolocation.options.limit,e.state=1})}}},e.event=function(t,r){return e.event.options=t,r||e.objects.push(clone(e.event(t,1))),{run:function(t){this.m=t||{},this.m.event=e.event.options,this.state=1}}},e.generic=function(t,r){return e.generic.options=t,r||e.objects.push(clone(e.generic(t,1))),{run:function(t){this.m=t||{},this.m.generic={},this.m.generic.type=e.generic.options.type,this.m.generic.data=e.generic.options.data,this.state=1,console.log(this)}}},e.time=function(t){return e.time.options=t,ready||e.objects.push(clone(e.time(t,1))),{run:function(t){this.m=t||{},this.m.time={},this.m.time.start=e.time.options.moment.start,this.m.time.end=e.time.options.moment.end,this.state=1}}},e.random=function(t){return e.random.options=t,ready||e.objects.push(clone(e.random(t,1))),{run:function(t){this.m=t||{},this.m.random={},this.m.random.amount=e.random.options.amount,this.state=1}}},e.pipeline=function(r,n){return O.agent="undefined"!=typeof r&&"function"!=typeof r?r:{},"undefined"!=typeof n&&"function"!=typeof n&&(O.objects=n),O.callback=arguments[arguments.length-1],O.protoline.push(this),O.linetype=e.type,O.provider="bind"===O.linetype?"Timeout":"Interval",O.runner="Interval","bind"===e.type&&"undefined"!=typeof e.target&&e.target.tagName&&(e.target["on"+e.on]=function(){return e.pipeline(r,O.objects,O.callback).run()}),{stop:function(){return O.signalStop=1},run:function(){O.t=window["set"+O.provider](function(){if(!e.running){if(!e.loaded)return O.connector.connect();if(e.signalStop||2===O.socket.readyState||3===O.socket.readyState)return O.connector.disconnect();O.running=1,O.socket.onmessage=function(t){return O.callback(O.interop.parse(t.data))};var r,n={},o=0,i={},s=0;for(var s in O.objects)O.objects[parseInt(s)].run(n),O.oot=window["set"+O.runner](function(){(0===o||1===O.objects[o-1].state)&&"object"==typeof O.objects[o]&&1===O.objects[o].state&&(n=t(n,O.objects[o].m),o++,window["clear"+O.runner](O.oot))},1);O.ooot=window["set"+O.runner](function(){o===O.objects.length&&(i.packet=n,r=(new Date).getTime(),i.packet.order=O.order,i.packet.timestamp=r,i.packet.interop=O.interop,i.uuid=O.uuid(),O.socket.send(O.interop.stringify(i)),"function"==typeof O.callback&&O.callback(i),O.running=0,window["clear"+O.runner](O.ooot))},1)}},O.freq)}}},e.sound=function(t){return e.sound.options=t,{run:function(t){this.m=t||{},this.m.sound={},this.m.sound.length=e.sound.options.length||60,this.m.sound.field=e.sound.options.field;var r=this;e.speech=new webkitSpeechRecognition,e.speech.onstart=function(){},e.speech.onresult=function(t){console.log(t),r.state=1},e.speech.lang=e.sound.options.lang||"en-GB",e.speech.start()}}},e.connector={connect:function(){return 0!==O.socket.readyState?O.setup(O.settings):void 0},disconnect:function(){return O.loaded=0,3!==O.socket.readyState?O.socket.close():void 0}},e.uuid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},e.uint8ToString=function(t){var e="[";for(var r in t)e+=r==t.length-1?t[r].toString()+"]":t[r].toString()+", ";return e},e.stringToUint8=function(t){for(var e=t.match(/(\d+)/g),r=[],n=0;n!=e.length;n++)r.push(parseInt(e[n]));return r},window.O=window.ol=e}.call(this);var object_create=Object.create;"function"!=typeof object_create&&(object_create=function(t){function e(){}return e.prototype=t,new e}),function(){var t,e=this;t="undefined"!=typeof exports?window.OnelineTransport||{}:e.OnelineTransport=window.OnelineTransport||{},t.WebSockets={},Oneline=window.Oneline||{},t.WebSockets.Ctor=function(t){return window.WebSocket?new window.WebSocket(t):new window.MozWebSocket(t)},t.WebSockets.detect=function(){return window.WebSocket?!0:window.MozWebSocket?!0:!1},t.XHR={},t.XHR.key=null,t.XHR.Ctor=function(e,r){return t.XHR.key||(t.XHR.key=Oneline.uuid()),t.XHR.reform(e,r)},t.XHR.opened=!1,t.XHR.reform=function(e,r){t.XHR.dataPost="modUrl="+r;var n=new XMLHttpRequest,r=Oneline.settings.server;return n.open("POST",e,!0),n.readyState=0,n.close=t.XHR.close,n.sendProto=n.send,n.send=t.XHR.send,n.onmessage=t.XHR.onmessage,n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("X-XHR-Websockets-Oneline",!0),n},t.XHR.close=function(){},t.XHR.send=function(e){Oneline.socket.loaded||(Oneline.socket=t.XHR.reform(Oneline.settings.xhrurl,Oneline.settings.server),Oneline.loaded=!1),t.XHR.opened||(t.XHR.opened=!0),Oneline.socket.onreadystatechange=function(){Oneline.socket.readyState=this.readyState,4===this.readyState&&this.code>=200&&this.code<=299&&t.XHR.onmessage({data:this.responseText})},t.XHR.dataPost+="&data="+e+"&key="+t.XHR.key,Oneline.socket.sendProto(t.XHR.dataPost)},t.XHR.onmessage=function(t){Oneline.socket.onmessage(t)},t.XHR.detect=function(){return window.XMLHttpRequest?!0:!1}}.call(this);
